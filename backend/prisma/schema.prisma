generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id             Int            @id @default(autoincrement())
  email          String         @unique
  password       String
  name           String?
  role           String         @default("USER")
  phone          String?
  address        String?
  city           String?
  pincode        String?
  loyaltyPoints  Int            @default(0)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  orders         Order[]
  cart           Cart?
  wishlist       WishlistItem[]
  reviews        Review[]
  addresses      Address[]
  giftCards      GiftCard[]
  pointsHistory  LoyaltyPoints[]
  notifications  ProductNotification[]
}

model Product {
  id              Int             @id @default(autoincrement())
  name            String
  description     String
  price           Float
  image           String
  category        String
  material        String?
  inStock         Boolean         @default(true)
  stockCount      Int             @default(100)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  OrderItems      OrderItem[]
  CartItems       CartItem[]
  wishlistItems   WishlistItem[]
  reviews         Review[]
  notifications   ProductNotification[]
}

model Cart {
  id        Int        @id @default(autoincrement())
  userId    Int        @unique
  user      User       @relation(fields: [userId], references: [id])
  items     CartItem[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}

model CartItem {
  id        Int     @id @default(autoincrement())
  cartId    Int
  cart      Cart    @relation(fields: [cartId], references: [id], onDelete: Cascade)
  productId Int
  product   Product @relation(fields: [productId], references: [id])
  quantity  Int     @default(1)

  @@unique([cartId, productId])
}

model Order {
  id                 Int            @id @default(autoincrement())
  userId             Int
  user               User           @relation(fields: [userId], references: [id])
  total              Float
  status             String         @default("PENDING")
  paymentMethod      String         @default("RAZORPAY")
  paymentStatus      String         @default("PENDING")
  razorpayOrderId    String?
  razorpayPaymentId  String?
  shippingName       String?
  shippingPhone      String?
  shippingAddress    String?
  shippingCity       String?
  shippingPincode    String?
  couponCode         String?
  discount           Float          @default(0)
  pointsEarned       Int            @default(0)
  pointsRedeemed     Int            @default(0)
  createdAt          DateTime       @default(now())
  items              OrderItem[]
  trackingHistory    OrderTracking[]
  returnRequests     ReturnRequest[]
}

model OrderItem {
  id        Int     @id @default(autoincrement())
  orderId   Int
  order     Order   @relation(fields: [orderId], references: [id])
  productId Int
  product   Product @relation(fields: [productId], references: [id])
  quantity  Int
  price     Float
}

model WishlistItem {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  productId Int
  product   Product  @relation(fields: [productId], references: [id])
  createdAt DateTime @default(now())

  @@unique([userId, productId])
}

model Review {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  productId Int
  product   Product  @relation(fields: [productId], references: [id])
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
}

// ============ NEW MODELS FOR ENHANCED FEATURES ============

// Address Book
model Address {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  name      String
  phone     String
  address   String
  city      String
  pincode   String
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
}

// Coupons
model Coupon {
  id            Int       @id @default(autoincrement())
  code          String    @unique
  discountType  String    // PERCENTAGE or FIXED
  discountValue Float
  minPurchase   Float?
  maxDiscount   Float?
  usageLimit    Int?
  usedCount     Int       @default(0)
  expiresAt     DateTime?
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
}

// Gift Cards
model GiftCard {
  id            Int       @id @default(autoincrement())
  code          String    @unique
  balance       Float
  initialValue  Float
  expiresAt     DateTime?
  purchasedById Int?
  purchasedBy   User?     @relation(fields: [purchasedById], references: [id])
  createdAt     DateTime  @default(now())
}

// Order Tracking
model OrderTracking {
  id        Int      @id @default(autoincrement())
  orderId   Int
  order     Order    @relation(fields: [orderId], references: [id])
  status    String
  location  String?
  message   String?
  timestamp DateTime @default(now())
}

// Returns & Exchanges
model ReturnRequest {
  id        Int      @id @default(autoincrement())
  orderId   Int
  order     Order    @relation(fields: [orderId], references: [id])
  reason    String
  status    String   @default("PENDING")
  type      String   // RETURN or EXCHANGE
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Loyalty Points
model LoyaltyPoints {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  points    Int
  type      String   // EARNED or REDEEMED
  orderId   Int?
  reason    String?
  createdAt DateTime @default(now())
}

// Product Notifications
model ProductNotification {
  id         Int      @id @default(autoincrement())
  userId     Int
  user       User     @relation(fields: [userId], references: [id])
  productId  Int
  product    Product  @relation(fields: [productId], references: [id])
  type       String   // BACK_IN_STOCK, PRICE_DROP
  notified   Boolean  @default(false)
  createdAt  DateTime @default(now())

  @@unique([userId, productId, type])
}

// Blog Posts
model BlogPost {
  id          Int       @id @default(autoincrement())
  title       String
  slug        String    @unique
  content     String
  excerpt     String
  coverImage  String
  author      String
  publishedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}
